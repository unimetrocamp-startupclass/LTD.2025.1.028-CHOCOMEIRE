{% extends 'base.html' %}

{% block content %}
<h2>Finalizar Pedido</h2>

<form action="{{ url_for('finalizar_pedido') }}" method="POST" class="form-finalizar">
    <div class="dados-cliente">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" required>

        <label for="email">E-mail:</label>
        <input type="email" id="email" name="email" required>
    </div>

    {% if carrinho %}
    <h3>Resumo do Pedido</h3>
    <table class="resumo-pedido">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Quantidade</th>
                <th>Sabores</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% set total = 0 %}
            {% for pid, qtd in carrinho.items() %}
                {% set produto = produtos[pid] %}
                {% set sabs = sabores[pid] if sabores[pid] is defined else [] %}
                {% set subtotal = produto.preco * qtd %}
                {% set total = total + subtotal %}
                <tr>
                    <td>{{ produto.nome }}</td>
                    <td>{{ qtd }}</td>
                    <td>{{ sabs | join(', ') if sabs else 'â€”' }}</td>
                    <td>R${{ '%.2f'|format(subtotal) }}</td>
                </tr>
            {% endfor %}
            <tr>
                <td colspan="3"><strong>Total</strong></td>
                <td><strong>R${{ '%.2f'|format(total) }}</strong></td>
            </tr>
        </tbody>
    </table>
    {% endif %}

    <div class="finalizar-actions">
        <button type="submit" class="btn-confirmar">Confirmar Pedido</button>
        <a href="{{ url_for('carrinho') }}" class="btn-voltar">Voltar ao Carrinho</a>
    </div>
</form>
{% endblock %}