{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2>Finalizar Pedido</h2>
    <form method="POST" action="{{ url_for('finalizar_pedido') }}">
        <div class="form-group">
            <label for="nome">Nome:</label>
            <input type="text" class="form-control" name="nome" required>
        </div>
        <div class="form-group">
            <label for="email">E-mail:</label>
            <input type="email" class="form-control" name="email" required>
        </div>
        <button type="submit" class="btn btn-success">Confirmar Pedido</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");

    form.addEventListener("submit", function (e) {
        e.preventDefault(); // Interrompe envio

        const carrinho = JSON.parse(sessionStorage.getItem("carrinho") || "{}");

        fetch("/sincronizar-carrinho", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ carrinho: carrinho })
        })
        .then(response => response.json())
        .then(() => {
            form.submit(); // Reenvia o formulÃ¡rio manualmente
        })
        .catch(() => {
            alert("Erro ao sincronizar o carrinho.");
        });
    });
});
</script>
{% endblock %}